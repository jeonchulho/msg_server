# MSA 전환/고도화 로드맵 (1-page)

본 문서는 현재 `msg_server`의 구조를 기준으로, **지금 유지할 것**과 **단계적으로 분리/고도화할 것**을 정리한 실행 로드맵입니다.

상세 실행 가이드:
- [MSA_DEEPDIVE_DBMAN_REDIS.md](MSA_DEEPDIVE_DBMAN_REDIS.md)

## 현재 포지션

- 현 상태는 “서비스 분리 + 중앙 데이터 게이트웨이(dbman)” 패턴
- 장점: 데이터 정책/멀티테넌트/감사 일관성
- 리스크: `dbman` 병목/장애 전파, 고트래픽 시 지연 증가

## 원칙

1. 서비스 경계를 유지하되, 핫패스만 점진적으로 최적화
2. Big-bang 재설계 대신 단계적 마이그레이션
3. 변경은 항상 SLO/부하테스트 결과로 승인

## 0~3개월: 안정화 단계 (Now)

유지:
- `chat/session/fileman/dbman/vectorman` 분리 구조
- DB 접근 단일 진입(`dbman`) 기본 정책

강화:
- `dbman` 수평 확장 + readiness/liveness + 오토스케일
- 메시지 저장 경로 관측성(지연 p95/p99, 에러율) 상시 모니터링
- `k6` 정기 부하 테스트 주간 실행

완료 기준:
- 피크 부하에서 메시지 저장 p95 목표 충족
- `dbman` 1개 인스턴스 장애 시 SLO 유지

## 3~6개월: 병목 분리 단계 (Next)

분리/고도화:
- 핫패스 읽기 캐시(방 메시지 최신 구간, unread count)
- 이벤트 내구성 강화(outbox + retry + DLQ)
- Redis 채널 핫스팟 완화(샤딩/채널 전략)

선택적 분리:
- 매우 고빈도 조회 API는 read-model 서비스로 분리 검토
- `dbman` 내부 API를 기능 그룹별로 모듈 분해

완료 기준:
- 트래픽 2~3배 증가 시 선형에 가까운 확장 확인
- 재처리/중복 방지 정책 운영 검증 완료

## 6~12개월: 도메인 소유권 강화 단계 (Later)

전환 방향:
- 도메인별 데이터 소유권 강화(완전 중앙집중 완화)
- 서비스 간 계약(API/event schema) 버전 정책 고도화
- 내부 통신 REST→gRPC(필요 경로) 검토

주의:
- 모든 데이터 분리를 한 번에 진행하지 말고, 핫패스 도메인부터 점진 적용
- 데이터 일관성 요구가 높은 기능은 `dbman` 경유 유지 가능

완료 기준:
- 핵심 도메인별 독립 배포/확장/장애격리 달성
- 운영 복잡도 증가 대비 자동화/관측성 체계 확보

## 즉시 실행 TODO (실무형)

- [ ] `chat_message_persist` 로그 기반 대시보드 1차 구성
- [ ] `load-chat-report` 주간 실행 후 결과 아카이브
- [ ] `dbman` 자원 상한/커넥션/타임아웃 표준값 문서화
- [ ] 장애 주입(runbook 포함) 월 1회 수행
